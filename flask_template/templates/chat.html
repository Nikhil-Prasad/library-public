{% extends "bootstrap/base.html" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-4">
            <div id="file-explorer" class="mb-3">
                <h5>File Explorer</h5>
                <ul id="file-list" class="list-group">
                    <!-- Dynamic file list should be populated here -->
                    <li class="list-group-item">File1.csv</li>
                    <li class="list-group-item">File2.csv</li>
                </ul>
            </div>
        </div>
        <div class="col-md-8">
            <div id="chat-container" class="border rounded p-3">
                <div id="chat-box" class="mb-3" style="height: 300px; overflow-y: auto;">
                    <!-- Chat messages will be displayed here -->
                </div>
                <div class="input-group mb-3">
                    <input type="text" id="user-input" class="form-control" placeholder="Type your message here...">
                    <button class="btn btn-primary" type="button" onclick="processMessage()">Send</button>
                </div>
                <div class="mb-3">
                    <input type="file" id="file-input" class="form-control" accept=".csv">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function processMessage() {
        var userInput = document.getElementById('user-input').value;
        console.log(userInput); // Implement the logic to process and display the message
        // Clear the input after sending the message
        document.getElementById('user-input').value = '';
    }
</script>
{% endblock %}

<script>
    function processMessage() {
        var message = $('#user-input').val();
        var file = $('#file-input')[0].files[0];
        var formData = new FormData();
        if (file) {
            formData.append('file', file);
        }
        
        formData.append('message', message);

        $.ajax({
            url: '/process_message',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                $('#chat-box').append('<div class="text-left">You: ' + message + '</div>');
                $('#chat-box').append('<div class="text-right">Bot: ' + response.message + '</div>');
                $('#user-input').val('');
            }
        });
    }
</script>
{% endblock %}
